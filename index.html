<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/buzz/1.1.10/buzz.min.js" type="text/javascript"></script>
</head>
<body style="background-color: black; position: absolute; top: 50%; left: 50%; transform: translateX(-50%) translateY(-50%);">
<canvas tabindex='1' id="canvas" width="900" height="900"></canvas>
<script>
    //##########################################################################
    // The game

    var g_canvas;
    var g_ctx;
    var g_current_screen;


    //##########################################################################
    // game engine

    //--------------------------------------------------------------------------
    function init()
    {
        //Canvas stuff
        var canvas_obj = $("#canvas");
        g_canvas = canvas_obj[0];
        g_ctx = g_canvas.getContext("2d");
        g_ctx.textAlign="start";
        g_ctx.textBaseline="middle";

        // todo


        // start processing events
        setTimeout(eventLoop, 40);
    }

    //--------------------------------------------------------------------------
    function eventLoop()
    {
        var start_time = Date.now();

//        if (mouse_click_pending) {
//            mouse_click_pending = false;
//            g_current_screen.handleMouseClick();
//        }
//
//        if (key_press_pending) {
//            key_press_pending = false;
//            g_current_screen.handleKeyPress();
//        }

//        g_current_screen.handleTimeStep();
//        g_current_screen.paint();

        var end_time = Date.now();
        var comp_time = end_time - start_time;
        if (comp_time > 40 || comp_time < 0) {
            setTimeout(eventLoop, 0);
        }
        else
        {
            setTimeout(eventLoop, 40 - comp_time);
        }
    }

    // launch the game once the document is fully loaded
    $(document).ready(init);

</script>
</body>
</html>
